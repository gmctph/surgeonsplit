<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Surgeon Split Calculator</title>
  <style>
    :root { --border:#ddd; --muted:#666; --bg:#fafafa; --card:#fff; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin: 24px; background: var(--bg); }
    .card { max-width: 980px; background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 18px; box-shadow: 0 2px 10px rgba(0,0,0,.04); }
    h1 { margin: 0 0 10px 0; font-size: 18px; }
    .subtitle { margin: 0 0 14px 0; color: var(--muted); font-size: 13px; }
    .grid3 { display: grid; grid-template-columns: 1.2fr 1fr 1fr 1fr; gap: 10px; align-items: end; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .hdr { font-weight: 800; text-align: center; padding: 8px 0; font-size: 14px; }
    .lbl { font-weight: 700; font-size: 13px; padding: 10px 4px 0 4px; }
    label { display:block; font-weight: 700; font-size: 13px; margin-bottom: 6px; }
    input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cfcfcf;
      border-radius: 10px;
      font-size: 14px;
      background: #fff;
      box-sizing: border-box;
    }
    input.readonly { background: #f3f3f3; }
    input.money { text-align: right; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }
    .row { margin-top: 10px; }
    .banner {
      display:none;
      margin: 14px 0 6px 0;
      padding: 10px 12px;
      border-radius: 10px;
      background: #fff2f2;
      border: 1px solid #ffb3b3;
      color: #8a0000;
      font-weight: 800;
      font-size: 13px;
    }
    .actions {
      margin-top: 18px;
      display: flex;
      justify-content: flex-end;
    }
    button {
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid #bbb;
      background: #0ad42e;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: #ececec; }
    .footer {
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Surgeon Split Calculator</h1>
<p class="subtitle">• Enter only the input fields (Start/End times + Total OR Fee). Everything else auto-calculates.<br>
    • If you don't enter "AM" or "PM" it will assume AM (7:12 => 7:12 AM) <br>
    • You can omit the colon and space if you want (712p => 7:12 PM)<br>
    • You can copy/paste times into the fields<br>
    </p>

    <div class="grid3">
      <div></div>
      <div class="hdr">Surgeon A</div>
      <div class="hdr">Surgeon B</div>
      <div class="hdr">Total Time</div>
    </div>

    <div class="grid3 row">
      <div class="lbl">Start</div>
      <div><input id="aStart" placeholder="7:55 or 7:55p" /></div>
      <div><input id="bStart" placeholder="9:35 or 935p" /></div>
      <div><input class="readonly" readonly placeholder="—" /></div>
    </div>

    <div class="grid3 row">
      <div class="lbl">End</div>
      <div><input id="aEnd" placeholder="11:25 or 1125p" /></div>
      <div><input id="bEnd" placeholder="12:12 or 1212p" /></div>
      <div><input class="readonly" readonly placeholder="—" /></div>
    </div>

    <div class="banner" id="banner"></div>

    <div class="grid3 row">
      <div class="lbl">Duration (h:mm)</div>
      <div><input id="aDurHM" class="readonly" readonly /></div>
      <div><input id="bDurHM" class="readonly" readonly /></div>
      <div><input id="tDurHM" class="readonly" readonly /></div>
    </div>

    <div class="grid3 row">
      <div class="lbl">Duration (decimal)</div>
      <div><input id="aDurDec" class="readonly" readonly /></div>
      <div><input id="bDurDec" class="readonly" readonly /></div>
      <div><input id="tDurDec" class="readonly" readonly /></div>
    </div>

    <div class="grid3 row">
      <div class="lbl">Percentage</div>
      <div><input id="aPct" class="readonly" readonly /></div>
      <div><input id="bPct" class="readonly" readonly /></div>
      <div><input class="readonly" readonly placeholder="100%" /></div>
    </div>

    <div class="grid2 row" style="margin-top:16px;">
      <div>
        <label>TOTAL OR FEE</label>
        <input id="fee" class="money" placeholder="e.g. 2964" />
      </div>
      <div>
        <label>Status</label>
        <input id="status" class="readonly" readonly />
      </div>
    </div>

    <div class="grid3 row">
      <div class="lbl">Surgeon Allocation</div>
      <div><input id="aAlloc" class="readonly money" readonly /></div>
      <div><input id="bAlloc" class="readonly money" readonly /></div>
      <div><input id="tAlloc" class="readonly money" readonly /></div>
    </div>

    <div class="actions">
      <button id="resetBtn" type="button">Reset (Esc)</button>
    </div>

    <div class="footer">
      Missing AM/PM → assumed AM. “p”/“P” = PM. Press <strong>Esc</strong> to reset. Focus returns to Surgeon A Start.
    </div>
  </div>

<script>
  const el = id => document.getElementById(id);

  const timeFields = ["aStart","aEnd","bStart","bEnd"];
  const inputs = [...timeFields, "fee"];

  function normalizeTimeInput(raw) {
    let s = (raw || "").trim();
    if (!s) return { ok:true, text:"", date:null };
    s = s.replace(/\s+/g,"");
    if (/[pP]$/.test(s) && !/(am|pm)$/i.test(s)) s = s.slice(0,-1)+"pm";
    if (/[aA]$/.test(s) && !/(am|pm)$/i.test(s)) s = s.slice(0,-1)+"am";

    let suffix="", m=s.match(/(am|pm)$/i);
    if (m) { suffix=m[1].toUpperCase(); s=s.slice(0,-m[1].length); }

    let h,mn;
    if (s.includes(":")) [h,mn]=s.split(":");
    else if (/^\d+$/.test(s)) {
      if (s.length<=2) { h="0"; mn=s.padStart(2,"0"); }
      else if (s.length===3) { h=s[0]; mn=s.slice(1); }
      else { h=s.slice(0,-2); mn=s.slice(-2); }
    } else return { ok:false };

    h=Number(h); mn=Number(mn);
    if (!Number.isFinite(h)||mn<0||mn>59) return { ok:false };
    if (!suffix) suffix="AM";
    const h24 = suffix==="PM" ? (h%12)+12 : (h%12);
    const d=new Date(); d.setHours(h24,mn,0,0);
    const pretty=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:true}).format(d);
    return { ok:true, text:pretty, date:d };
  }

  function parseTimeToday(v){ const r=normalizeTimeInput(v); return r.ok?r.date:null; }
  function normalizeOnBlur(id){
    el(id).addEventListener("blur",()=>{ const r=normalizeTimeInput(el(id).value); if(r.ok) el(id).value=r.text; });
  }

  function minutesBetween(a,b){ return Math.round((b-a)/60000); }
  function fmtHM(m){ const h=Math.floor(m/60),mm=String(m%60).padStart(2,"0"); return `${h}:${mm}`; }
  function fmtDec(h){ return h.toFixed(2); }
  function fmtPct(p){ return Math.round(p*100)+"%"; }
  function fmtUSD(n){ return n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0}); }

  function clearOutputs(){
    ["aDurHM","bDurHM","tDurHM","aDurDec","bDurDec","tDurDec","aPct","bPct","aAlloc","bAlloc","tAlloc","status"]
      .forEach(id=>el(id).value="");
    el("banner").style.display="none";
    el("banner").textContent="";
  }

  function resetAll(){
    inputs.forEach(id=>el(id).value="");
    clearOutputs();
    el("aStart").focus();
  }

  function recompute(){
    const aS=parseTimeToday(el("aStart").value), aE=parseTimeToday(el("aEnd").value);
    const bS=parseTimeToday(el("bStart").value), bE=parseTimeToday(el("bEnd").value);
    const fee=Number((el("fee").value||"").replace(/[^0-9.]/g,"")||0);

    clearOutputs();

    if (aS&&aE){
      const m=minutesBetween(aS,aE);
      if (m<0){ el("banner").textContent="CHECK TIMES: Surgeon A End < Start"; el("banner").style.display="block"; return; }
      el("aDurHM").value=fmtHM(m); el("aDurDec").value=fmtDec(m/60);
    }
    if (bS&&bE){
      const m=minutesBetween(bS,bE);
      if (m<0){ el("banner").textContent="CHECK TIMES: Surgeon B End < Start"; el("banner").style.display="block"; return; }
      el("bDurHM").value=fmtHM(m); el("bDurDec").value=fmtDec(m/60);
    }

    if (aS&&aE&&bS&&bE){
      const aMin=minutesBetween(aS,aE), bMin=minutesBetween(bS,bE);
      const tMin=aMin+bMin;
      el("tDurHM").value=fmtHM(tMin); el("tDurDec").value=fmtDec(tMin/60);
      const pA=aMin/tMin, pB=bMin/tMin;
      el("aPct").value=fmtPct(pA); el("bPct").value=fmtPct(pB);
      el("aAlloc").value=fmtUSD(Math.round(fee*pA));
      el("bAlloc").value=fmtUSD(Math.round(fee*pB));
      el("tAlloc").value=fmtUSD(fee);
      el("status").value="OK";
    }
  }

  inputs.forEach(id=>el(id).addEventListener("input",recompute));
  timeFields.forEach(normalizeOnBlur);

  el("resetBtn").addEventListener("click", resetAll);

  // Keyboard shortcut: Esc = Reset
  document.addEventListener("keydown", e => {
    if (e.key === "Escape") {
      e.preventDefault();
      resetAll();
    }
  });

  // Initial focus
  el("aStart").focus();
</script>
</body>
</html>
